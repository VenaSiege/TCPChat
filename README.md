# TCP 聊天软件

一个基于 Python 的简易 TCP 聊天应用，支持多客户端连接和实时消息通信。

## 功能特性

- ✅ **多客户端支持**：服务器可同时处理多个客户端连接
- ✅ **实时消息广播**：消息自动发送给所有在线用户
- ✅ **用户加入/离开通知**：系统提示用户的连接状态变化
- ✅ **时间戳记录**：每条消息都带有时间戳
- ✅ **线程池处理**：使用多线程处理并发连接
- ✅ **易于使用**：提供批处理脚本快速启动

## 项目结构

```
TCPChat/
├── server.py          # TCP 聊天服务器
├── client.py          # TCP 聊天客户端
├── run_server.bat     # 启动服务器脚本
├── run_client.bat     # 启动客户端脚本
└── README.md          # 本文件
```

## 系统要求

- Python 3.6 或更高版本
- Windows 系统
- 网络连接

## 使用方法

### 方式一：使用批处理脚本（Windows）

1. **启动服务器**
   - 双击 `run_server.bat` 文件
   - 或在命令行运行：`python server.py`

2. **启动客户端**
   - 双击 `run_client.bat` 文件
   - 或在命令行运行：`python client.py`

### 方式二：使用命令行

**启动服务器（在第一个终端）：**
```bash
python server.py
```

**启动客户端（在其他终端）：**
```bash
python client.py
```

## 详细说明

### 服务器 (server.py)

- **监听地址**：`0.0.0.0`（所有网卡）
- **监听端口**：`5000`
- **功能**：
  - 接受客户端连接
  - 接收客户端消息
  - 将消息广播给所有在线客户端
  - 管理客户端连接状态

**启动示例：**
```
[服务器] 启动成功，监听 0.0.0.0:5000
[服务器] 等待客户端连接...

[14:30:25] 【客户端连接】张三 (127.0.0.1:52841)
[14:30:35] 张三: 大家好
[14:30:45] 【客户端断开】张三 (在线用户数: 0)
```

### 客户端 (client.py)

- **功能**：
  - 连接到服务器
  - 设置用户名
  - 发送和接收消息
  - 实时显示消息

**使用步骤：**
1. 输入服务器地址（默认 localhost）
2. 输入服务器端口（默认 5000）
3. 输入用户名
4. 开始聊天
5. 输入 `exit` 退出

**连接示例：**
```
==================================================
         TCP 聊天客户端
==================================================

请输入服务器地址 (默认为 localhost): 127.0.0.1
请输入服务器端口 (默认为 5000): 5000

[客户端] 已连接到 127.0.0.1:5000

请输入你的用户名 (默认为 Guest): 小王
【系统】欢迎 小王！当前在线用户数: 1

开始聊天 (输入 'exit' 退出):

> 你好，大家好
> exit
[客户端] 正在断开连接...
[客户端] 已断开连接
```

## 网络配置

### 本地测试
- 服务器地址：`localhost` 或 `127.0.0.1`
- 端口：`5000`

### 局域网通信
- 服务器地址：服务器机器的 IP 地址（如 `192.168.1.100`）
- 端口：`5000`

### 远程通信
- 需要配置防火墙，允许 5000 端口通过
- 使用服务器的公网 IP 地址

## 消息格式

### 系统消息
- 用户连接：`【系统】用户名 加入了聊天室`
- 用户断开：`【系统】用户名 离开了聊天室`
- 欢迎消息：`【系统】欢迎 用户名！当前在线用户数: N`

### 聊天消息
- 格式：`[HH:MM:SS] 用户名: 消息内容`
- 示例：`[14:30:35] 张三: 大家好`

## 故障排除

### 问题1：客户端无法连接到服务器
**症状**：
```
[错误] 无法连接到服务器 localhost:5000
[提示] 请确保服务器已启动
```

**解决方案**：
1. 确保服务器已启动
2. 检查服务器和客户端的地址和端口是否一致
3. 检查防火墙是否阻止了连接

### 问题2：端口已被占用
**症状**：
```
[错误] [Errno 48] Address already in use
```

**解决方案**：
1. 检查是否已有服务器在运行
2. 修改端口号（在 server.py 和 client.py 中修改 port 参数）
3. 等待一段时间后重试（TCP TIME_WAIT）

### 问题3：中文显示乱码
**症状**：消息中的中文显示为乱码

**解决方案**：
1. 确保使用 UTF-8 编码
2. 在 Windows 命令行中运行 `chcp 65001` 切换到 UTF-8 编码
3. 使用支持 UTF-8 的终端（如 PowerShell Core）

## 性能指标

- **最大连接数**：取决于系统资源，通常 100+ 个并发连接
- **消息延迟**：毫秒级别（取决于网络）
- **吞吐量**：受限于网络带宽

## 安全注意事项

⚠️ **此应用为演示程序，请注意以下安全问题**：

1. **无身份验证**：任何人都可以连接
2. **无加密**：消息以明文传输
3. **无消息持久化**：消息不存储，服务器重启后消息丢失
4. **无访问控制**：所有消息对所有用户可见

**生产环境建议**：
- 添加用户认证机制
- 使用 SSL/TLS 加密传输
- 实现消息持久化存储
- 添加用户权限管理
- 实现消息审核机制

## 扩展功能建议

1. **私聊功能**：支持用户之间的私密消息
2. **聊天室**：支持创建多个聊天室
3. **用户列表**：显示当前在线用户列表
4. **消息历史**：保存和查询消息历史
5. **文件传输**：支持文件分享
6. **表情符号**：支持 emoji 和其他富文本
7. **身份验证**：用户登录/注册功能
8. **数据库存储**：持久化存储消息和用户信息

## 许可证

MIT License

## 作者

TCP Chat Team

## 联系方式

如有问题或建议，欢迎联系我们。
