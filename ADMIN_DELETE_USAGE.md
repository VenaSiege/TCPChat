# 管理员删除用户功能使用指南

## 概述

管理员删除用户功能允许具有管理员权限的用户删除系统中的任何用户账户（除了最后一个管理员账户）。

## 功能特性

- ✅ 管理员可以删除任何普通用户
- ✅ 管理员可以删除其他管理员（但不能删除最后一个管理员）
- ✅ 删除前会显示用户列表供参考
- ✅ 删除前需要确认操作
- ✅ 如果被删除的用户在线，会自动终止其会话
- ✅ 删除成功后会广播通知给所有在线用户
- ✅ 普通用户无法使用此功能

## 使用方法

### 1. 以管理员身份登录

首先，您需要以管理员账户登录到聊天系统。

```
请选择操作 (1-6): 1
用户名: admin1
密码: ******
[HH:MM:SS] 【成功】登录成功！欢迎 admin1 (管理员)
```

### 2. 进入聊天室后使用管理员命令

登录成功后，您会看到管理员命令提示：

```
==================================================
         进入聊天室
==================================================
欢迎 admin1！

管理员命令: /listusers - 查看用户列表, /deleteuser - 删除用户

开始聊天 (输入 'exit' 或 'logout' 退出):
```

### 3. 查看用户列表（可选）

在删除用户前，您可以先查看当前的用户列表：

```
> /listusers

--- 用户列表 ---

============================================================
用户名                   角色         状态
============================================================
admin1               管理员       在线
user1                普通用户     在线
user2                普通用户     离线
============================================================
总计: 3 个用户
```

### 4. 删除用户

输入 `/deleteuser` 命令开始删除流程：

```
> /deleteuser

--- 管理员删除用户 ---
正在获取用户列表...

[显示用户列表]

请输入要删除的用户名
目标用户名: user2

警告：您即将删除用户 'user2'
此操作无法撤销！
确认删除此用户？(yes/no): yes

[HH:MM:SS] 【成功】用户 'user2' 已成功删除
```

### 5. 系统广播

删除成功后，所有在线用户都会收到通知：

```
[HH:MM:SS] 【系统】管理员已删除用户 user2
```

如果被删除的用户当前在线，该用户会收到特殊通知并被断开连接：

```
【系统】您的账户已被管理员删除，连接即将断开
```

## 错误处理

### 普通用户尝试删除

如果普通用户尝试使用删除命令：

```
> /deleteuser
[HH:MM:SS] 【错误】此命令仅限管理员使用
```

### 删除不存在的用户

```
目标用户名: nonexistent
确认删除此用户？(yes/no): yes
[HH:MM:SS] 【错误】目标用户不存在
```

### 删除最后一个管理员

```
目标用户名: admin1
确认删除此用户？(yes/no): yes
[HH:MM:SS] 【错误】无法删除最后一个管理员账户
```

### 取消删除操作

在确认提示时输入 "no" 或其他非 "yes" 的内容：

```
确认删除此用户？(yes/no): no
[系统] 删除操作已取消
```

## 协议详情

### 客户端到服务器

```
ADMIN_DELETE_USER <admin_username> <target_username>
```

### 服务器到客户端

成功响应：
```
ADMIN_DELETE_SUCCESS <deleted_username>
```

失败响应：
```
ADMIN_DELETE_FAILURE <error_message>
```

## 安全注意事项

1. **权限验证**：服务器会验证请求用户是否为管理员
2. **最后管理员保护**：系统至少保留一个管理员账户
3. **在线会话终止**：删除在线用户时会自动终止其会话
4. **操作不可逆**：删除操作无法撤销，请谨慎使用
5. **操作日志**：所有删除操作都会广播通知

## 相关功能

- `/listusers` - 查看所有用户列表（仅管理员）
- 普通用户可以使用认证菜单中的"删除账户"选项删除自己的账户

## 技术实现

- **客户端方法**：`ChatClient.admin_delete_user()`
- **服务器方法**：`AuthenticationManager.admin_delete_user()`
- **协议命令**：`ADMIN_DELETE_USER`
- **响应格式**：`ADMIN_DELETE_SUCCESS` / `ADMIN_DELETE_FAILURE`

## 测试

运行以下命令测试功能：

```bash
# 测试客户端实现
python test_admin_delete_client.py

# 测试完整集成
python test_admin_delete_integration.py
```
